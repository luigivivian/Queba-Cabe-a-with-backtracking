<!DOCTYPE html>
<html lang="pt">
    <head>
        <title>Quebra cabeça</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" href="stylera.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    </head>
    <body>
<div class="game" id="game">
    <div id="container" class="tabuleiro">
        <div id="n1" onclick="mover('n1')" class="peca" data-value="1"></div>
        <div id="n2" onclick="mover('n2')"  class="peca" data-value="2"></div>
        <div id="n3" onclick="mover('n3')" class="peca" data-value="3"></div>
        <div id="n4" onclick="mover('n4')" class="peca" data-value="4"></div>
        <div id="n5" onclick="mover('n5')" class="peca" data-value="5"></div>
        <div id="n6" onclick="mover('n6')" class="peca" data-value="6"></div>
        <div id="n7" onclick="mover('n7')" class="peca" data-value="7"></div>
        <div id="n8" onclick="mover('n8')" class="peca" data-value="8"></div>
        <div id="n0" data-value="0"></div>
    </div>

        <button id="Iniciar" onclick="startGame()" type="button" name="button" class="btn btn-primary col-md-2 col-md-offset-5">Iniciar</button>
        <button id="Resetar" onclick="startGame()" type="button" name="button" class="btn btn-primary col-md-2 col-md-offset-5">Resetar</button>
        <button id="Resolver" onclick="resolver()" type="button" name="button" class="btn btn-success col-md-2 col-md-offset-5">Resolver Quebra-cabeça</button>
        <button id="undo" onclick="undo()" type="button" name="button" class="btn btn-warning col-md-2 col-md-offset-5">Voltar Jogadas</button>



    </div>
    <div class="rodape col-md-4 col-md-offset-4">
        <br>
        <br>
        <br>
        <h2>ADS-Casca 2017</h2>
        <h2>Criado por: Luigi Vivian</h2>
    </div>
    <!--fim div game  -->
    </body>


    <script type="text/javascript">
    $(document).ready(function(){
        init();
        $('#resetar').hide();
    });
    //array que armazena o estado do jogo
    var iniciar = false;
    var pecas = [
        [document.querySelector("#n1"), document.querySelector("#n2"), document.querySelector("#n3")],
        [document.querySelector("#n4"), document.querySelector("#n5"), document.querySelector("#n6")],
        [document.querySelector("#n7"), document.querySelector("#n8"), document.querySelector("#n0")],
];

var final = [
    [document.querySelector("#n1"), document.querySelector("#n2"), document.querySelector("#n3")],
    [document.querySelector("#n4"), document.querySelector("#n5"), document.querySelector("#n6")],
    [document.querySelector("#n7"), document.querySelector("#n8"), document.querySelector("#n0")],
];

    //tela de start game
    //função que inicializa os elementos do jogo
    function init(){
        //varre os elementos 'n' adicionando a texto e inserindo na matriz
        var ii = 1;
        for(var l = 0; l < 3; l++){
            for (var c = 0; c < 3; c++) {
                var peca = document.querySelector("#n"+ii);
                console.log(peca);
                $('#n'+ii).text(''+ii);

                //pecas.push(peca);
                pecas[l][c] = peca;
                fim = pecas[l][c];
                ii++;
            }

        }
        pecas[2][2] = document.querySelector("#n0");
        //completa o array com um espaço nulo e o copia para a resposta, depois renderiza o tabuleiro


        render();
    }
ii = 0;
    function render(){ //Organizar peças no tabuleiro.
        for (var l = 0; l < 3; l++) {
            for (var c = 0; c < 3; c++) {
                var peca = pecas[l][c];
                var id = $(peca).prop("id");
                if(peca){
                    //peca.style.left = (i%3) * 200 + "px";
                    //$('#'+id).css('left', (ii%3) * 200 + 'px')
                    ii++;
                    //document.getEle
                    if(l == 0){
                        //peca.style.top = "2px";
                        $('#'+id).css('top', '2px')
                    } else
                    if(l == 1){
                        //peca.style.top = "200px";
                        $('#'+id).css('top', '200px')
                    } else {
                        //peca.style.top = "400px";
                        $('#'+id).css('top', '400px')
                    }

                    if(c == 0){
                        //peca.style.top = "2px";
                        $('#'+id).css('left', '2px')
                    } else
                    if(c == 1){
                        //peca.style.top = "200px";
                        $('#'+id).css('left', '200px')
                    } else {
                        //peca.style.top = "400px";
                        $('#'+id).css('left', '400px')
                    }


                }
            }
    }
}
                //left 0,200,400 top 2px = primeira linha
                //left 0,200,400 top 200px = primeira linha
                //left 0,200,400 top 400px = primeira linha

//filas
var zeroX = [];
var zeroY = [];
var jogadasX = [];
var jogadasY = [];
var jogadasIDS = [null];
    function mover(id){
        if(iniciar == false){
            iniciar == true;
            alert('Inicie o jogo !');
            return;
        }

        var busca = id;
        var x;
        var y;
YYY: for (var i = 0; i < 3; i++){
         for (var j = 0; j < 3; j++){
             var peca = pecas[i][j];
             var id = $(peca).prop("id");
             console.log(id);
             if (busca === id){
                 y = i;
                break YYY;
             }

         }
}
console.log("y="+y);
    XXX: for (var i = 0; i < 3; i++){
             for (var j = 0; j < 3; j++){
                 var peca = pecas[i][j];
                 var id = $(peca).prop("id");
                 if (busca === id){
                     x = j;
                    break XXX;
                 }

             }
    }
console.log("x="+x);
console.log("idid="+id)
                //y = linha
                //x = coluna
                if(y == 0){// verificando linha 0
                    if(pecas[y][x + 1] == document.querySelector("#n0")){
                        console.log("coluna + 1 livre");
                        pecas[y][x + 1] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x + 1);
                        jogadasY.push(y);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('left', '+=200px')
                    }
                    if(pecas[y][x - 1] == document.querySelector("#n0")){
                        console.log("coluna - 1 livre");
                        pecas[y][x - 1] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x - 1);
                        jogadasY.push(y);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('left', '-=200px')
                    }
                    if(pecas[y + 1][x] == document.querySelector("#n0")){
                        pecas[y + 1][x] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x);
                        jogadasY.push(y + 1);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('top', '+=200px')
                    }
                }
                if(y == 1){// verificando linha 0
                    if(pecas[y][x + 1] == document.querySelector("#n0")){
                        console.log("x + 1 livre");
                        pecas[y][x + 1] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x + 1);
                        jogadasY.push(y);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('left', '+=200px')
                    }
                    if(pecas[y][x - 1] == document.querySelector("#n0")){
                        console.log("x - 1 livre");
                        pecas[y][x - 1] = document.querySelector("#"+id);;
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x - 1);
                        jogadasY.push(y);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('left', '-=200px')
                    }
                    if(pecas[y + 1][x] == document.querySelector("#n0")){
                        console.log("y + 1 livre");
                        pecas[y + 1][x] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x);
                        jogadasY.push(y + 1);
                        jogadasIDS.push('#'+id);

                        //$('#'+id).animate('top', '+=200px')
                    }
                    if(pecas[y - 1][x] == document.querySelector("#n0")){
                        console.log("y - 1 livre");
                        pecas[y - 1][x] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x);
                        jogadasY.push(y - 1);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('top', '-=200px')
                    }
                }
                if(y == 2){// verificando linha 0
                    if(pecas[y][x + 1] == document.querySelector("#n0")){
                        pecas[y][x + 1] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x + 1);
                        jogadasY.push(y);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('left', '+= 200px')
                    }
                    if(pecas[y][x - 1] == document.querySelector("#n0")){
                        pecas[y][x - 1] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x - 1);
                        jogadasY.push(y);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).css('left', '-= 200px')
                    }
                    if(pecas[y - 1][x] == document.querySelector("#n0")){
                        pecas[y - 1][x] = document.querySelector("#"+id);
                        pecas[y][x] = document.querySelector("#n0");
                        zeroX.push(x);
                        zeroY.push(y);
                        jogadasX.push(x);
                        jogadasY.push(y - 1);
                        jogadasIDS.push('#'+id);
                        //$('#'+id).animate('top', '-=200px')
                    }
                }

                if(check()){
                    alert("parabéns voce venceu");
                    $('#resetar').show();
                }
                render();
    }
    function check(){
        for (var i = 0; i < 3; i++) {
            for (var j = 0; j < 3; j++) {
                var a = pecas[i][j];
                var b = final[i][j];
                if(a !== b){
                    return false;
                }
            }
        }
        return true;
    }

    //getGame

    function undo(){
        var idss =jogadasIDS.pop();
        if(idss == null){
            return;
        }else{
            var x,y;
            x = zeroX.pop();
            y = zeroY.pop();
            pecas[y][x] = document.querySelector(idss);

            x = jogadasX.pop();
            y = jogadasY.pop();
            pecas[y][x] = document.querySelector("#n0");
            render();
        }
    }

    var backID;
    var backX;
    var backY;

    var backZeroX;
    var backZeroY;
    function getGame(){
        var g1 = [
            [document.querySelector("#n0"), document.querySelector("#n1"), document.querySelector("#n3")],
            [document.querySelector("#n4"), document.querySelector("#n8"), document.querySelector("#n5")],
            [document.querySelector("#n2"), document.querySelector("#n7"), document.querySelector("#n6")]
            ];
        backID = ['#n4','#n2','#n7','#n8','#n2','#n4','#n1','#n2','#n5','#n6'];
        //fila vai para
        backY = [1,2,2,1,1,0,0,1,1,2];
        backX = [0,0,1,1,0,0,1,1,2,2];
        //Zero vai para ...
        backZeroY = [0,1,2,2,1,1,0,0,1,1];
        backZeroX = [0,0,0,1,1,0,0,1,1,2];
        //////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////////////////
        var g2 = [
            //Y
            //O
            [document.querySelector("#n1"), document.querySelector("#n3"), document.querySelector("#n5")],
            //1
            [document.querySelector("#n4"), document.querySelector("#n8"), document.querySelector("#n0")],
            //2
            [document.querySelector("#n2"), document.querySelector("#n7"), document.querySelector("#n6")]
            /////x/////    0    /////////////////////    1    /////////////////////    2    ///////////
                    ];
                    //0
            //[document.querySelector("#n1"), document.querySelector("#n3"), document.querySelector("#n5")],
            //1
            //[document.querySelector("#n4"), document.querySelector("#n8"), document.querySelector("#n0")],
            //2
            //[document.querySelector("#n2"), document.querySelector("#n7"), document.querySelector("#n6")]
            /////x/////    0    /////////////////////    1    /////////////////////    2    ///////////

        backID = ['#n5','#n3','#n1','#n4','#n2', '#n7', '#n8', '#n2', '#n4', '#n1', '#n2', '#n5','#n6'];
        //fila vai para   /
        backY = [0,0,0,1, 2, 2, 1, 1, 0, 0, 1, 1,2];
        backX = [2,1,0,0, 0, 1, 1, 0, 0, 1, 1, 2,2];

        //Zero vai para ...
        backZeroY = [1,0,0,0, 1, 2, 2, 1, 1, 0, 0, 1,1];
        backZeroX = [2,2,1,0, 0, 0, 1, 1, 0, 0, 1, 1,2];

        var jogos = [];
        jogos.push(g1);
        jogos.push(g2);
        jogos.sort(function(a, b){return 0.5 - Math.random()})
        return jogos[0];


    }
    function iniciarGame(){
        //game 1
        var getJogo = getGame();
        console.log('JOGO :' +getJogo);
        for (var i = 0; i < 3; i++) {
            for (var j = 0; j < 3; j++) {
                pecas[i][j] = getJogo[i][j];

            }
        }
        render();
    }

    var resolv = false;
    function resolver(){
        if(jogadasIDS.length != 0){
            undo();
            return;
        }
        resolv = true;
                   var idzao;
                   var idzao = backID.shift();
                   if(idzao == null){
                       resolv = false;
                       return;
                   }else{
                       var x,y;
                       y = backZeroY.shift();
                       x = backZeroX.shift();
                       console.log('xX='+x)
                       console.log('yY='+y)
                       pecas[y][x] = document.querySelector(''+idzao);

                       y = backY.shift();
                       x = backX.shift();
                       pecas[y][x] = document.querySelector('#n0');

                       render();
                   }
                   if(check()){
                        alert('Parabéns "você" venceu, renicie para jogar novamente !');

                   }
}
    function startGame(){
        iniciarGame();
        iniciar = true;
        //$('#iniciar').hide();
        $('#resolver').show();
        //iniciar = true;
    }
    </script>
</html>

